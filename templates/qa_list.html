{% extends "base.html" %}

{% block title %}QA List - OStation{% endblock %}

{% block head %}
<style>
  /* QA 列表轻量样式（以 Bootstrap 风格为主） */
  .qa-wrapper { max-width: 960px; margin: 0 auto 32px; }
  .qa-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: .5rem; }
  .qa-title { margin: 0; font-weight: 600; letter-spacing: .2px; }
  .qa-sub { margin: 0 0 .75rem; color: #6c757d; font-size: .95rem; }
  .qa-search { max-width: 420px; }

  /* 限制长文本在列表页的显示高度，保持整洁 */
  .answer-cell {
    display: -webkit-box;
    line-clamp: 3;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .question-cell { font-weight: 600; word-break: break-word; }
  .answer-cell { color: #495057; word-break: break-word; }
  .date-cell { white-space: nowrap; color: #6c757d; font-size: .9rem; }
  .table > :not(caption) > * > * { vertical-align: top; }

  .no-data { text-align: center; color: #777; font-style: italic; padding: 16px 0; }

  /* 小屏优化：隐藏时间列，便于阅读 */
  @media (max-width: 576px) {
    .qa-table th:nth-child(3), .qa-table td:nth-child(3) { display: none; }
  }
</style>
{% endblock %}

{% block content %}
<div class="container qa-wrapper">
  <div class="qa-header">
    <h2 class="qa-title">QA List</h2>
    <a href="{{ url_for('qa_edit') }}" class="btn btn-primary btn-sm">Edit QA</a>
  </div>
  <p class="qa-sub">Frequently asked questions and answers</p>
  <div class="mb-3">
    <input id="qaSearch" type="search" class="form-control qa-search" placeholder="Search questions..." aria-label="Search questions">
  </div>

  {% if qa_list %}
    <div class="card shadow-sm border-0">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-striped table-hover align-middle qa-table mb-0">
            <colgroup>
              <col style="width: 30%">
              <col style="width: 55%">
              <col style="width: 15%">
            </colgroup>
            <thead class="table-light">
              <tr>
                <th>Question</th>
                <th>Answer</th>
                <th>Created At</th>
              </tr>
            </thead>
            <tbody>
              {% for qa in qa_list %}
              <tr>
                <td class="question-cell">{{ qa.question }}</td>
                <td class="answer-cell">{{ qa.answer }}</td>
                <td class="date-cell" data-raw="{{ qa.created_at }}">{{ qa.created_at }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% else %}
    <p class="no-data">No QA records found</p>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
  // 格式化日期为 YYYY-MM-DD
  (function formatDates() {
    const els = document.querySelectorAll('.date-cell');
    els.forEach(el => {
      const raw = (el.getAttribute('data-raw') || el.textContent || '').trim();
      const d = new Date(raw);
      if (!isNaN(d.getTime())) {
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        el.textContent = `${y}-${m}-${day}`;
      }
    });
  })();

  // 搜索过滤（按问题与答案内容）
  (function enableSearch() {
    const input = document.getElementById('qaSearch');
    if (!input) return;
    const rows = Array.from(document.querySelectorAll('.qa-table tbody tr'));
    input.addEventListener('input', function () {
      const q = this.value.trim().toLowerCase();
      rows.forEach(row => {
        const qCell = row.querySelector('.question-cell')?.textContent.toLowerCase() || '';
        const aCell = row.querySelector('.answer-cell')?.textContent.toLowerCase() || '';
        const match = !q || qCell.includes(q) || aCell.includes(q);
        row.style.display = match ? '' : 'none';
      });
    });
  })();
</script>
{% endblock %}

