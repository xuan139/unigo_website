{% extends "base.html" %}

{% block title %}Confirm Delete QA - OStation{% endblock %}

{% block head %}
<style>
  .qa-wrapper { max-width: 720px; margin: 0 auto 32px; }
  .qa-title { margin: 0 0 .5rem; font-weight: 600; }
  .qa-sub { color: #6c757d; margin: 0 0 1rem; }
</style>
{% endblock %}

{% block content %}
<div class="container qa-wrapper">
  <h2 class="qa-title">Confirm Delete</h2>
  <p class="qa-sub">This action cannot be undone. Please proceed with caution.</p>

  <div class="alert alert-danger" role="alert">
    Are you sure you want to delete the following question?
  </div>

  <div class="mb-3">
    <strong>{{ question }}</strong>
  </div>

  <form id="deleteForm" method="POST" action="{{ url_for('delete_qa', qa_id=qa_id) }}" class="d-flex align-items-center gap-2">
    <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">Confirm Delete</button>
    <a href="{{ url_for('qa_edit') }}" class="btn btn-outline-secondary">Cancel</a>
  </form>

  <!-- Second Confirmation Modal -->
  <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Deletion</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          This will permanently delete the question:
          <strong class="d-block mt-2">{{ question }}</strong>
          {% if answer %}
          <div class="mt-2 small text-muted" style="display:-webkit-box;line-clamp:4;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden;">
            {{ answer }}
          </div>
          {% endif %}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="confirmDeleteBtn" class="btn btn-danger">Delete</button>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.getElementById('confirmDeleteBtn')?.addEventListener('click', function () {
    document.getElementById('deleteForm')?.submit();
  });
  // 回车键避免误删：仅在 Modal 中再确认时才提交
  document.getElementById('deleteForm')?.addEventListener('keydown', function (e) {
    if (e.key === 'Enter') { e.preventDefault(); }
  });
</script>
{% endblock %}
