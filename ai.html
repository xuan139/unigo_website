<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Chat Demo</title>
  <script type="module">
    import { pipeline } from "https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0";

    let generator;

    async function init() {
      document.getElementById("status").innerText = "⏳ 正在加载模型，请稍等...";
      // 加载一个小型 GPT 模型（tiny 版本，适合浏览器）
      generator = await pipeline(
        "text-generation",
        "Xenova/distilgpt2"  // 也可换更小的 gpt2 模型
      );
      document.getElementById("status").innerText = "✅ 模型已就绪，可以聊天啦！";
    }

    async function chat() {
      const input = document.getElementById("userInput").value;
      if (!input.trim()) return;

      const outputBox = document.getElementById("chatBox");
      outputBox.innerHTML += `<p><b>你:</b> ${input}</p>`;

      const response = await generator(input, {
        max_new_tokens: 50,
        temperature: 0.7,
        top_p: 0.9
      });

      const aiText = response[0].generated_text.replace(input, "").trim();
      outputBox.innerHTML += `<p><b>AI:</b> ${aiText}</p>`;
      document.getElementById("userInput").value = "";
    }

    init();
    window.chat = chat;
  </script>
</head>
<body style="font-family: sans-serif; max-width: 700px; margin: 2rem auto;">
  <h2>🤖 本地聊天 AI Demo</h2>
  <p id="status">加载中...</p>

  <div id="chatBox" style="border: 1px solid #ccc; padding: 10px; min-height: 200px;"></div>

  <textarea id="userInput" rows="3" cols="60" placeholder="输入一句话..."></textarea><br><br>
  <button onclick="chat()">发送</button>
</body>
</html>
